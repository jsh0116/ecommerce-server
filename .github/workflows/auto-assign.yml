name: Auto Assign

on:
  pull_request:
    types: [opened, ready_for_review]

permissions:
  pull-requests: write
  issues: write
  contents: read


jobs:
  assign-pr:
    name: Assign PR to Author
    runs-on: ubuntu-latest

    steps:
      - name: Assign PR to author
        uses: actions/github-script@v8
        with:
          script: |
            // PR ì‘ì„±ìë¥¼ í• ë‹¹
            github.rest.issues.addAssignees({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              assignees: [context.payload.pull_request.user.login]
            });

            console.log(`Assigned PR #${context.issue.number} to @${context.payload.pull_request.user.login}`);

      - name: Add labels based on branch
        uses: actions/github-script@v8
        with:
          script: |
            const branch = context.payload.pull_request.head.ref;
            let labels = [];

            // ë¸Œëœì¹˜ ì´ë¦„ì— ë”°ë¼ ë¼ë²¨ ìë™ í• ë‹¹
            if (branch.startsWith('feature/')) {
              labels.push('enhancement');
            } else if (branch.startsWith('bugfix/')) {
              labels.push('bug');
            } else if (branch.startsWith('hotfix/')) {
              labels.push('critical');
            } else if (branch === 'develop') {
              labels.push('development');
            }

            if (labels.length > 0) {
              github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                labels: labels
              });

              console.log(`Added labels: ${labels.join(', ')}`);
            }

      - name: Add welcome comment
        uses: actions/github-script@v8
        with:
          script: |
            const author = context.payload.pull_request.user.login;

            const comment = `ğŸ‘‹ Welcome @${author}!

              Thank you for your contribution!
              
              ğŸ” **Checklist before merge:**
              - [ ] Tests pass locally
              - [ ] No breaking changes
              - [ ] Code follows project style
              - [ ] PR description is clear
              
              ğŸ’¡ **Tips:**
              - Check the CI/CD results below
              - AI Code Review will analyze your changes
              - Respond to review comments as needed
              
              Looking forward to reviewing your PR! ğŸš€`;

            github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: comment
            });
