# 의류 이커머스 플랫폼 요구사항 명세서

**프로젝트명:** Fashion Store
**버전:** 1.0.0
**작성일:** 2025-10-31

---

## 📋 목차

1. [프로젝트 개요](#프로젝트-개요)
2. [스테이크홀더](#스테이크홀더)
3. [기능적 요구사항](#기능적-요구사항)
4. [비기능적 요구사항](#비기능적-요구사항)
5. [비즈니스 규칙](#비즈니스-규칙)
6. [제약사항](#제약사항)
7. [위험 요소](#위험-요소)

---

## 🎯 프로젝트 개요

### 목적
온라인 의류 쇼핑 경험을 제공하는 이커머스 플랫폼 구축

### 핵심 가치 제안
- 정확한 사이즈 추천으로 반품률 감소
- 실시간 재고 관리로 오버셀링 방지
- 빠르고 편리한 반품/교환 프로세스
- AI 기반 스타일 추천

### 비즈니스 목표
- 월 거래액 10억원 달성
- 반품률 20% 이하 유지
- 고객 재구매율 40% 달성
- 평균 주문 처리 시간 24시간 이내

---

## 👥 스테이크홀더

### 1. 고객 (Customer)
- **역할:** 상품 구매, 리뷰 작성
- **권한:**
    - 상품 조회 및 검색
    - 주문 및 결제
    - 반품/교환 신청
    - 리뷰 작성

### 2. 관리자 (Admin)
- **역할:** 상품 관리, 주문 처리, CS 응대
- **권한:**
    - 상품 등록/수정/삭제
    - 재고 관리
    - 주문 상태 변경
    - 반품/교환 승인/거부
    - 통계 조회

### 3. 판매자 (Seller) - 마켓플레이스 모델인 경우
- **역할:** 상품 등록, 주문 처리
- **권한:**
    - 자사 상품 관리
    - 주문 확인 및 출고
    - 정산 내역 조회

### 4. CS 담당자 (CS Agent)
- **역할:** 고객 문의 응대
- **권한:**
    - 주문 조회
    - 반품/교환 처리
    - 쿠폰 발급

---

## ⚙️ 기능적 요구사항

### 1: 상품 관리

#### 1.1 상품 검색 및 조회
- **요구사항:** 사용자는 키워드, 카테고리, 필터로 상품을 검색할 수 있어야 한다.
- **우선순위:** P0 (Critical)
- **상세:**
    - Elasticsearch 기반 전문 검색
    - 다면 검색 (브랜드, 가격, 색상, 사이즈)
    - 자동완성 지원
    - 검색 결과 정렬 (인기순, 가격순, 최신순)

#### 1.2 다중 변량 상품 (Multi-Variant)
- **요구사항:** 하나의 상품은 여러 색상, 사이즈 조합을 가질 수 있어야 한다.
- **우선순위:** P0
- **상세:**
    - SKU 코드로 각 변량 식별
    - 색상 × 사이즈 × 길이 조합
    - 변량별 독립적 재고 관리
    - 변량별 가격 차등 가능

#### 1.3 사이즈 가이드 및 추천
- **요구사항:** 브랜드별 사이즈 가이드를 제공하고 사용자 맞춤 사이즈를 추천해야 한다.
- **우선순위:** P1
- **상세:**
    - 사용자 신체 정보 입력 (키, 몸무게, 체형)
    - 구매 이력 기반 학습
    - 리뷰 데이터 분석 ("작아요", "커요")

#### 1.4 상품 리뷰
- **요구사항:** 구매 확정 후 리뷰를 작성할 수 있어야 한다.
- **우선순위:** P1
- **상세:**
    - 평점 (1-5점), 텍스트, 사진 리뷰
    - 사이즈 평가 (작음/적당/큼)
    - 도움됨 표시 기능
    - 포토 리뷰 추가 포인트 적립

---

### 2: 재고 관리

#### 2.1 실시간 재고 조회
- **요구사항:** 사용자는 실시간 재고 현황을 확인할 수 있어야 한다.
- **우선순위:** P0
- **상세:**
    - 가용 재고, 예약 재고, 물리적 재고 구분
    - 재고 상태 (재고 있음, 품절 임박, 품절)
    - 품절 임박 시 경고 표시 (5개 이하)

#### 2.2 재고 차감 및 예약
- **요구사항:** 주문 생성 시 재고를 예약하고, 결제 승인 시 차감해야 한다.
- **우선순위:** P0
- **상세:**
    - 주문 생성: 재고 예약 (15분 TTL)
    - 결제 승인: 실재고 차감
    - 결제 실패/취소: 예약 즉시 해제
    - 동시성 제어: Pessimistic Lock + Redis 분산 락

#### 2.3 재입고 알림
- **요구사항:** 품절 상품의 재입고 알림을 신청할 수 있어야 한다.
- **우선순위:** P1
- **상세:**
    - 알림 방식: Email, Push, SMS
    - 선착순 알림 발송
    - 알림 발송 후 24시간 내 구매 우선권

---

### 3: 장바구니 및 주문

#### 3.1 장바구니
- **요구사항:** 사용자는 여러 상품을 장바구니에 담을 수 있어야 한다.
- **우선순위:** P0
- **상세:**
    - 로그인 시: DB 저장
    - 비로그인 시: 브라우저 로컬 저장
    - 수량 변경, 삭제 가능
    - 품절 상품 자동 안내

#### 3.2 주문 생성
- **요구사항:** 장바구니 또는 상품 상세에서 바로 주문할 수 있어야 한다.
- **우선순위:** P0
- **상세:**
    - 배송지 선택/입력
    - 배송 방법 선택 (일반, 당일, 새벽)
    - 쿠폰 적용
    - 포인트 사용
    - 최종 금액 계산

#### 3.3 주문 취소
- **요구사항:** 특정 조건 하에 주문을 취소할 수 있어야 한다.
- **우선순위:** P0
- **상세:**
    - 결제 대기: 즉시 취소
    - 결제 완료: 발송 전까지 가능
    - 배송 시작: 취소 불가 (반품 안내)
    - 자동 환불 처리

---

### 4: 결제

#### 4.1 다양한 결제 수단
- **요구사항:** 여러 결제 수단을 지원해야 한다.
- **우선순위:** P0
- **상세:**
    - 신용카드, 체크카드
    - 계좌이체, 가상계좌
    - 간편결제 (카카오페이, 네이버페이)

#### 4.2 결제 실패 처리
- **요구사항:** 결제 실패 시 재시도를 유도해야 한다.
- **우선순위:** P0
- **상세:**
    - 실패 사유 안내
    - 최대 3회 재시도 가능
    - 다른 결제 수단 제안
    - Exponential Backoff 재시도

#### 4.3 환불 처리
- **요구사항:** 취소/반품 시 자동으로 환불해야 한다.
- **우선순위:** P0
- **상세:**
    - 신용카드: 승인 취소 (3~7일)
    - 계좌이체: 환불 계좌 입금 (영업일 3일)
    - 부분 환불 지원 (쿠폰/포인트 차감)

---

### 5: 쿠폰 및 포인트

#### 5.1 쿠폰 시스템
- **요구사항:** 다양한 유형의 쿠폰을 발급하고 사용할 수 있어야 한다.
- **우선순위:** P1
- **상세:**
    - 쿠폰 유형: 정액, 정률, 배송비 무료, N+1
    - 최소 주문 금액 조건
    - 사용 기한 설정
    - 선착순 쿠폰 (동시성 제어)
    - 1주문 1쿠폰 제한

#### 5.2 포인트 시스템
- **요구사항:** 구매 금액의 일정 비율을 포인트로 적립해야 한다.
- **우선순위:** P1
- **상세:**
    - 기본 적립률: 1%
    - VIP 회원: 2%
    - 적립 시점: 구매 확정 시
    - 사용 단위: 1,000P 이상
    - 소멸 기간: 1년

---

### 6: 배송

#### 6.1 배송비 계산
- **요구사항:** 주문 금액과 지역에 따라 배송비를 자동 계산해야 한다.
- **우선순위:** P0
- **상세:**
    - 기본 배송비: 3,000원
    - 무료 배송: 30,000원 이상
    - 제주/도서산간: +3,000원
    - 배송 불가 지역 차단

#### 6.2 배송 추적
- **요구사항:** 실시간으로 배송 상태를 추적할 수 있어야 한다.
- **우선순위:** P0
- **상세:**
    - 택배사 API 연동
    - 배송 상태 업데이트 (1시간 주기)
    - 배송 지연 시 자동 SMS 발송

#### 6.3 묶음 배송
- **요구사항:** 동일 판매자의 여러 상품을 묶음 배송할 수 있어야 한다.
- **우선순위:** P2
- **상세:**
    - 판매자별 자동 그룹핑
    - 묶음 배송비 1회만 부과
    - 분할 배송 선택 가능

---

### 7: 반품 및 교환

#### 7.1 반품 신청
- **요구사항:** 배송 완료 후 7일 이내 반품을 신청할 수 있어야 한다.
- **우선순위:** P0
- **상세:**
    - 반품 사유 선택 (단순 변심, 불량, 오배송)
    - 사진 첨부 (불량인 경우 필수)
    - 배송비 부담 주체 자동 계산
    - 환불 방법 선택

#### 7.2 교환 신청
- **요구사항:** 다른 사이즈/색상으로 교환을 신청할 수 있어야 한다.
- **우구사항:** P0
- **상세:**
    - 교환 가능 재고 실시간 확인
    - 재고 없으면 환불/대기 선택
    - 교환 배송비 처리

#### 7.3 반품/교환 승인
- **요구사항:** 관리자가 반품/교환을 검수하고 승인/거부해야 한다.
- **우선순위:** P0
- **상세:**
    - 상품 도착 후 3일 내 검수
    - 승인 시 자동 환불/교환 발송
    - 거부 시 고객 재배송

---

### 8: 회원 관리

#### 8.1 회원가입 및 로그인
- **요구사항:** 이메일 또는 소셜 계정으로 가입/로그인할 수 있어야 한다.
- **우선순위:** P0
- **상세:**
    - 이메일 + 비밀번호
    - 소셜 로그인 (카카오, 네이버, 구글)
    - JWT 토큰 기반 인증

#### 8.2 회원 등급
- **요구사항:** 구매 금액에 따라 등급이 자동으로 변경되어야 한다.
- **우선순위:** P1
- **상세:**
    - 일반 회원: 가입 후 기본
    - VIP 회원: 최근 6개월 100만원 이상
    - 등급별 혜택 차등 (무료배송, 추가 포인트)

#### 8.3 배송지 관리
- **요구사항:** 여러 배송지를 저장하고 관리할 수 있어야 한다.
- **우선순위:** P0
- **상세:**
    - 최대 10개 저장
    - 기본 배송지 설정
    - 주소 검색 (다음/카카오 API)

---

## 🚀 비기능적 요구사항

### 1: 성능

#### 1.1 응답 시간
- **요구사항:** 95% 요청이 300ms 이내에 응답해야 한다.
- **측정 지표:**
    - 상품 목록 조회: < 200ms
    - 상품 상세 조회: < 300ms
    - 장바구니 추가: < 100ms
    - 주문 생성: < 500ms

#### 1.2 처리량 (Throughput)
- **요구사항:**
    - 평상시: 100 TPS
    - 피크 시간 (세일): 1,000 TPS
    - 동시 접속자: 10,000명

#### 1.3 데이터베이스 성능
- **요구사항:**
    - 쿼리 응답 시간: < 50ms (95th percentile)
    - Connection Pool: 최소 20, 최대 50
    - 인덱스 최적화: 주요 조회 필드

---

### 2: 가용성 (Availability)

#### 2.1 시스템 가동률
- **요구사항:** 연간 99.9% 이상 (다운타임 8.76시간 이내)
- **대응 방안:**
    - 무중단 배포 (Blue-Green Deployment)
    - Health Check 및 자동 재시작
    - 장애 알림 (Slack, PagerDuty)

#### 2.2 재해 복구 (Disaster Recovery)
- **요구사항:**
    - RPO (Recovery Point Objective): 1시간
    - RTO (Recovery Time Objective): 4시간
    - 일일 자동 백업

---

### 11: 확장성 (Scalability)

#### 11.1 수평 확장
- **요구사항:**
    - 트래픽 증가 시 자동 스케일 아웃
    - Stateless 아키텍처
    - Load Balancer 적용

#### 11.2 데이터베이스 확장
- **요구사항:**
    - Read Replica 구성
    - 필요 시 Sharding 전략 수립
    - 캐시 레이어 (Redis)

---

### 12: 보안 (Security)

#### 12.1 인증 및 인가
- **요구사항:**
    - JWT 기반 인증
    - 토큰 만료 시간: 1시간 (Access), 7일 (Refresh)
    - HTTPS 강제 적용

#### 12.2 데이터 보호
- **요구사항:**
    - 개인정보 암호화 (AES-256)
    - 비밀번호 해싱 (bcrypt, salt rounds 10)
    - 민감 정보 마스킹 (전화번호 끝 4자리)

#### 12.3 결제 보안
- **요구사항:**
    - PCI-DSS 준수 (PG사 위임)
    - 카드번호 비저장
    - PG사 토큰 방식 사용

---

### 13: 유지보수성 (Maintainability)

#### 13.1 코드 품질
- **요구사항:**
    - 코드 커버리지: 80% 이상
    - Linter/Formatter 적용
    - Code Review 필수

#### 13.2 모니터링
- **요구사항:**
    - APM (Application Performance Monitoring) 도구 도입
    - 로그 수집 및 분석 (ELK Stack)
    - 핵심 지표 대시보드

---

### 14: 사용성 (Usability)

#### 14.1 반응형 디자인
- **요구사항:**
    - 모바일, 태블릿, 데스크톱 대응
    - 터치 인터페이스 최적화

#### 14.2 접근성 (Accessibility)
- **요구사항:**
    - WCAG 2.1 Level AA 준수
    - 스크린 리더 지원
    - 키보드 네비게이션

---

## 📜 비즈니스 규칙

### BR-1: 재고 관리
1. **재고 차감 시점:** 결제 승인 시
2. **재고 예약 TTL:** 15분
3. **안전 재고:** 최소 5% 또는 3개
4. **품절 임박 기준:** 5개 이하

### BR-2: 주문 및 결제
1. **최소 주문 금액:** 없음
2. **무료 배송 기준:** 30,000원 이상
3. **쿠폰 중복 사용:** 불가 (1주문 1쿠폰)
4. **포인트 최소 사용:** 1,000P 이상

### BR-3: 반품 및 교환
1. **반품 가능 기간:** 배송 완료 후 7일
2. **반품 배송비 (단순 변심):** 6,000원 (고객 부담)
3. **반품 배송비 (불량/오배송):** 무료 (판매자 부담)
4. **교환 재고 부족 시:** 환불 전환 or 재입고 대기

### BR-4: 포인트
1. **기본 적립률:** 1%
2. **VIP 적립률:** 2%
3. **적립 시점:** 구매 확정 (배송 완료 7일 후)
4. **소멸 기간:** 최종 적립일로부터 1년

### BR-5: 회원 등급
1. **일반 → VIP:** 최근 6개월 구매액 100만원 이상
2. **등급 갱신 주기:** 매월 1일
3. **VIP 혜택:** 전 상품 무료배송, 2% 적립

---

## ⚠️ 제약사항

### 기술적 제약사항
1. **데이터베이스:** PostgreSQL 14 이상
2. **캐시:** Redis 7 이상
3. **검색 엔진:** Elasticsearch 8 이상
4. **PG사:** 이니시스 또는 토스페이먼츠
5. **택배사 API:** CJ대한통운 연동

### 운영 제약사항
1. **배치 작업 시간:** 새벽 2-4시 (트래픽 최소 시간)
2. **재고 동기화:** 1시간 주기
3. **정산 주기:** 주 1회 (매주 월요일)

### 법적 제약사항
1. **개인정보보호법** 준수
2. **전자상거래법** 준수
3. **소비자보호법** 준수
4. **데이터 보관 기간:** 회원 탈퇴 후 5년

---

## 📊 P0 Critical 요구사항 (프로덕션 배포 필수)

### 분산 트랜잭션 및 보안 관련 P0 요구사항

본 섹션의 모든 항목은 **프로덕션 배포 필수 요구사항(P0 Critical)**입니다. 이 항목들 없이는 상업 서비스 운영이 불가능합니다.

#### P0-1: Idempotency Key를 통한 멱등성 보장

**요구사항:** 중복 결제 방지를 위해 모든 결제 요청에 Idempotency-Key를 사용해야 한다.

**상세:**
- **데이터 저장:** PAYMENTS 테이블에 `idempotency_key` VARCHAR(255) UNIQUE 인덱스
- **구현 규칙:**
    - 클라이언트: UUID v4 생성, 동일 결제에는 항상 같은 키 전송
    - 서버: 중복 요청 감지 시 기존 결과 반환 (멱등성)
    - 결과 저장 시: `ORDER_ID + IDEMPOTENCY_KEY` 복합 UNIQUE 인덱스

**비즈니스 가치:**
- 네트워크 오류 시 재전송 안전
- 결제 실패 후 재시도 안전 (중복 결제 방지)
- 분산 시스템에서 안정성 확보

---

#### P0-2: Saga Pattern을 통한 분산 트랜잭션 관리

**요구사항:** 결제 + 재고 차감의 원자성을 보장해야 하며, 실패 시 보상 트랜잭션을 수행해야 한다.

**테이블 설계:**

1. **RESERVATIONS 테이블:**
    - 주문 생성 시 재고 예약 (15분 TTL)
    - 상태 추적: ACTIVE → CONFIRMED → EXPIRED/CANCELLED
    - 자동 만료 배치 작업: 5분마다 실행
    - 예약 실패 시 주문 자동 취소

2. **PAYMENT_FAILURES 테이블:**
    - 결제 실패 로그 기록
    - 보상 트랜잭션 상태 추적 (PENDING → COMPENSATED/FAILED)
    - PG사 오류 코드 저장
    - 환불 처리 이력 관리

**보상 트랜잭션 시나리오:**

| 시나리오 | 문제 | 해결 방법 | 상태 변경 |
|---------|------|---------|---------|
| 결제 성공 → 재고 차감 실패 | 돈은 나갔는데 재고 미차감 | PG사 결제 취소 + 환불 | PAYMENT_COMPLETE → PAYMENT_COMPENSATED |
| 환불 진행 → 재고 복구 실패 | 돈은 돌려받는데 재고 미복구 | 멱등성 보장된 재고 복구 재시도 | REFUND_PENDING → REFUND_COMPLETED |
| 주문 생성 → 결제 미진행 | 15분 내 결제 미완료 | 예약 자동 해제 | PENDING_PAYMENT → RESERVATION_EXPIRED |

---

#### P0-3: Webhook 보안 및 멱등성 처리

**요구사항:** PG사 Webhook을 안전하게 처리하고, 중복 처리를 방지해야 한다.

**테이블 설계:**

1. **WEBHOOK_LOGS 테이블:**
    - 이벤트별 처리 상태 추적
    - `event_id` VARCHAR(255) UNIQUE 제약 조건 (중복 방지)
    - 상태: PROCESSING → QUEUED → COMPLETED/FAILED
    - 오류 메시지 기록
    - 재시도 횟수 추적

2. **WEBHOOK_RETRY_QUEUE 테이블:**
    - 실패한 Webhook 자동 재시도
    - 지수 백오프: 1분 → 5분 → 30분 → 1시간
    - 최대 3회 재시도
    - 최대 재시도 초과 시 CS 알림 자동 생성

**검증 3단계:**

1. **서명 검증 (HMAC-SHA256)**
    - PG사 Secret Key로 요청 본문 검증
    - 타이밍 공격 방지 (시간 기반 비교)

2. **Nonce/Timestamp 검증**
    - 요청 타임스탬프 유효성 (5분 이내)
    - Nonce 일회성 확인 (Redis 사용)
    - Replay Attack 방지

3. **Event ID 중복 확인 (Idempotency)**
    - WEBHOOK_LOGS에 event_id UNIQUE 제약
    - 이미 처리된 이벤트는 200 OK로 무시
    - 네트워크 중복 전송 안전

**비즈니스 가치:**
- PG사 Webhook 위조 공격 방지
- 중복 처리로 인한 환불, 포인트 오류 방지
- 자동 재시도로 높은 안정성 확보 (99.9% 목표)

---

#### P0-4: 재고 예약 및 만료 관리

**요구사항:** 주문 생성 시 재고를 예약하고, 결제 미완료 시 자동 해제해야 한다.

**구현 규칙:**

1. **재고 예약 (주문 생성 시):**
    - RESERVATIONS 테이블에 INSERT
    - 예약 상태: ACTIVE
    - 만료 시간: now() + 15분
    - 예약 실패 → 주문 생성 실패 (409 INSUFFICIENT_STOCK)

2. **재고 확인 공식:**
   ```
   available_inventory = physical_stock - reserved_stock - safety_stock
   ```

3. **자동 만료 처리:**
    - 배치 작업: 5분마다 실행
    - 조건: expires_at < now() AND status = 'ACTIVE'
    - 처리: 상태 → EXPIRED, 재고 복구
    - 주문 상태 → RESERVATION_EXPIRED (고객 재주문 가능)

**모니터링 지표:**
- 예약 만료율: < 5%
- 오버셀링 발생: 0건
- 재고 동시성 오류: < 0.1%

---

#### P0-5: 분산 락을 통한 동시성 제어

**요구사항:** 재고 차감 시 여러 요청이 동시에 접근하지 않도록 제어해야 한다.

**구현 전략:**

| 락 종류 | 사용 장면 | TTL | 효율성 |
|--------|---------|-----|--------|
| 비관적 락 (DB Lock) | 재고 차감 | 트랜잭션 내 | 높음, 대기 발생 |
| 낙관적 락 (Version) | 포인트 적립 | N/A | 낮음, 재시도 필요 |
| Redis 분산 락 | 쿠폰 발급 (다중 인스턴스) | 3초 | 중간, 좋은 성능 |

---

### P0 요구사항 체크리스트

| 항목 | 테이블 | 구현 | 테스트 | 모니터링 |
|------|--------|------|--------|---------|
| Idempotency Key | PAYMENTS | ✅ | ✅ | 추적 중복 요청 수 |
| Saga Pattern | RESERVATIONS, PAYMENT_FAILURES | ✅ | ✅ | 보상 TX 실행 횟수 |
| Webhook 보안 | WEBHOOK_LOGS, WEBHOOK_RETRY_QUEUE | ✅ | ✅ | 처리 성공률 99.9% |
| 재고 예약 TTL | RESERVATIONS | ✅ | ✅ | 만료율, 오버셀링 |
| 동시성 제어 | INVENTORY (index) | ✅ | ✅ | 락 대기 시간 |

**배포 전 필수 검증:**
- [ ] Idempotency Key 처리 통합 테스트 (정상 + 재전송 케이스)
- [ ] Saga Pattern 보상 TX 동작 검증 (실패 시나리오 3가지)
- [ ] Webhook 멱등성 테스트 (중복 수신 + 순서 뒤바뀐 경우)
- [ ] 재고 동시성 테스트 (다중 요청 동시 처리)
- [ ] 모니터링 대시보드 구성 (알람 임계값 설정)

---

## 🚨 위험 요소

### 기술적 위험
| 위험 | 발생 확률 | 영향도 | 대응 방안 |
|------|---------|--------|---------|
| 오버셀링 발생 | 중 | 높음 | 재고 동시성 제어 강화, 모니터링 |
| 결제 장애 | 낮음 | 높음 | PG사 이중화, Circuit Breaker |
| 성능 저하 (세일 기간) | 높음 | 중 | Auto Scaling, 캐싱 전략 |
| 데이터 유실 | 낮음 | 높음 | 일일 백업, Replication |

### 비즈니스 위험
| 위험 | 발생 확률 | 영향도 | 대응 방안 |
|------|---------|--------|---------|
| 높은 반품률 | 중 | 중 | 사이즈 추천 시스템 고도화 |
| CS 처리 지연 | 중 | 중 | CS 도구 개선, 자동 응답 |
| 재고 부족 | 중 | 중 | 재입고 알림, 안전 재고 |

---

## 📌 우선순위 정의

**P0 (Critical):** 서비스 런칭 불가능 - 반드시 구현  
**P1 (High):** 서비스 운영에 필수 - 런칭 후 1개월 내  
**P2 (Medium):** 사용자 경험 개선 - 런칭 후 3개월 내  
**P3 (Low):** 부가 기능 - 백로그

—

**문서 버전 히스토리**

| 버전 | 날짜 | 작성자 | 변경 내역 |
|———|———|————|—————|
| 1.0.0 | 2025-10-31 | Dev Team | 초안 작성 |